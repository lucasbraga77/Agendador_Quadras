<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Central Smart Home</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; overflow-x: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Home, Lightbulb, Calendar, Newspaper, Cloud, CheckSquare, Mic, Sun, Droplets, Wind, Power, Plus, X } = lucide;

        function HomeAutomationHub() {
          const [currentTime, setCurrentTime] = useState(new Date());
          const [devices, setDevices] = useState([
            { id: 1, name: 'Sala de Estar', type: 'light', status: false, room: 'Sala', alexaCommand: 'Alexa, acender luz da sala' },
            { id: 2, name: 'Quarto Principal', type: 'light', status: true, room: 'Quarto', alexaCommand: 'Alexa, acender luz do quarto' },
            { id: 3, name: 'Cozinha', type: 'light', status: false, room: 'Cozinha', alexaCommand: 'Alexa, acender luz da cozinha' },
            { id: 4, name: 'Tomada TV', type: 'outlet', status: true, room: 'Sala', alexaCommand: 'Alexa, ligar tomada TV' },
            { id: 5, name: 'Ar Condicionado', type: 'ac', status: false, room: 'Quarto', alexaCommand: 'Alexa, ligar ar condicionado' },
          ]);
          
          const [weather, setWeather] = useState({
            temp: 24,
            condition: 'Carregando...',
            humidity: 65,
            wind: 12
          });

          const [news, setNews] = useState([
            { id: 1, title: 'Carregando notÃ­cias...', source: 'Aguarde', time: '' }
          ]);

          const [tasks, setTasks] = useState([
            { id: 1, text: 'Comprar mantimentos', done: false },
            { id: 2, text: 'Pagar conta de luz', done: false },
            { id: 3, text: 'Levar cachorro ao veterinÃ¡rio', done: true }
          ]);

          const [agenda, setAgenda] = useState([
            { id: 1, time: '14:00', event: 'ReuniÃ£o de trabalho', date: 'Hoje' },
            { id: 2, time: '18:30', event: 'Jantar em famÃ­lia', date: 'Hoje' },
            { id: 3, time: '10:00', event: 'Consulta mÃ©dica', date: 'AmanhÃ£' }
          ]);

          const [showCommandModal, setShowCommandModal] = useState(false);
          const [selectedDevice, setSelectedDevice] = useState(null);
          const [showAddTask, setShowAddTask] = useState(false);
          const [newTaskText, setNewTaskText] = useState('');

          useEffect(() => {
            const timer = setInterval(() => setCurrentTime(new Date()), 1000);
            loadWeather();
            loadNews();
            return () => clearInterval(timer);
          }, []);

          const loadWeather = async () => {
            try {
              const response = await fetch('/api/weather');
              const data = await response.json();
              setWeather(data);
            } catch (error) {
              console.log('Usando dados de clima padrÃ£o');
              setWeather({
                temp: 24,
                condition: 'Parcialmente nublado',
                humidity: 65,
                wind: 12
              });
            }
          };

          const loadNews = async () => {
            try {
              const response = await fetch('/api/news');
              const data = await response.json();
              setNews(data);
            } catch (error) {
              console.log('Usando notÃ­cias padrÃ£o');
              setNews([
                { id: 1, title: 'Configure NEWS_API_KEY para ver notÃ­cias reais', source: 'Sistema', time: '' }
              ]);
            }
          };

          const handleDeviceClick = (device) => {
            setSelectedDevice(device);
            setShowCommandModal(true);
          };

          const toggleTask = (id) => {
            setTasks(tasks.map(task =>
              task.id === id ? { ...task, done: !task.done } : task
            ));
          };

          const addTask = () => {
            if (newTaskText.trim()) {
              const newTask = {
                id: Math.max(...tasks.map(t => t.id), 0) + 1,
                text: newTaskText,
                done: false
              };
              setTasks([...tasks, newTask]);
              setNewTaskText('');
              setShowAddTask(false);
            }
          };

          const Icon = ({ name, className }) => {
            const icons = {
              'Home': Home, 'Lightbulb': Lightbulb, 'Calendar': Calendar,
              'Newspaper': Newspaper, 'Cloud': Cloud, 'CheckSquare': CheckSquare,
              'Mic': Mic, 'Sun': Sun, 'Droplets': Droplets, 'Wind': Wind,
              'Power': Power, 'Plus': Plus, 'X': X
            };
            const Component = icons[name];
            return Component ? React.createElement(Component, { className }) : null;
          };

          const getDeviceIcon = (type) => {
            switch(type) {
              case 'light': return <Icon name="Lightbulb" className="w-5 h-5" />;
              case 'outlet': return <Icon name="Power" className="w-5 h-5" />;
              case 'ac': return <Icon name="Wind" className="w-5 h-5" />;
              default: return <Icon name="Lightbulb" className="w-5 h-5" />;
            }
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white p-3 md:p-6">
              <header className="mb-6">
                <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6">
                  <div className="flex items-center gap-3">
                    <div className="bg-gradient-to-br from-purple-600 to-blue-600 p-3 rounded-xl shadow-lg">
                      <Icon name="Home" className="w-7 h-7" />
                    </div>
                    <div>
                      <h1 className="text-2xl md:text-3xl font-bold">Central Smart Home</h1>
                      <p className="text-purple-300 text-sm">Santa Cruz do Sul, RS</p>
                    </div>
                  </div>
                  <div className="text-left md:text-right">
                    <div className="text-3xl md:text-4xl font-bold tabular-nums">
                      {currentTime.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                    </div>
                    <div className="text-purple-300 text-sm capitalize">
                      {currentTime.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' })}
                    </div>
                  </div>
                </div>
              </header>

              <div className="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-xl p-4 mb-6 border border-blue-400/30">
                <div className="flex items-center gap-3">
                  <Icon name="Mic" className="w-6 h-6 flex-shrink-0" />
                  <div className="flex-1">
                    <h3 className="font-bold mb-1">Controle por Voz Ativo</h3>
                    <p className="text-sm text-blue-100">Use sua Alexa normalmente. Toque nos dispositivos para ver os comandos</p>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
                
                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20">
                  <div className="flex items-center gap-2 mb-4">
                    <Icon name="Cloud" className="w-6 h-6 text-purple-400" />
                    <h2 className="text-lg font-semibold">Clima Atual</h2>
                  </div>
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="text-4xl md:text-5xl font-bold">{weather.temp}Â°C</div>
                      <div className="text-purple-300 mt-2 text-sm">{weather.condition}</div>
                    </div>
                    <Icon name="Sun" className="w-14 h-14 md:w-16 md:h-16 text-yellow-400" />
                  </div>
                  <div className="grid grid-cols-2 gap-4 mt-6 pt-6 border-t border-white/20">
                    <div className="flex items-center gap-2">
                      <Icon name="Droplets" className="w-5 h-5 text-blue-400" />
                      <span className="text-sm">{weather.humidity}%</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <Icon name="Wind" className="w-5 h-5 text-gray-400" />
                      <span className="text-sm">{weather.wind} km/h</span>
                    </div>
                  </div>
                </div>

                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20 lg:col-span-2">
                  <div className="flex items-center gap-2 mb-4">
                    <Icon name="Lightbulb" className="w-6 h-6 text-purple-400" />
                    <h2 className="text-lg font-semibold">Meus Dispositivos</h2>
                    <span className="ml-auto text-xs text-purple-300">Toque para ver comando</span>
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                    {devices.map(device => (
                      <button
                        key={device.id}
                        onClick={() => handleDeviceClick(device)}
                        className="p-4 rounded-xl border-2 transition-all duration-300 bg-white/5 border-white/20 hover:bg-white/10 hover:border-purple-400 active:scale-95"
                      >
                        <div className="flex items-center justify-between mb-2">
                          {getDeviceIcon(device.type)}
                          <Icon name="Mic" className="w-4 h-4 text-blue-400" />
                        </div>
                        <div className="text-left">
                          <div className="font-semibold text-sm">{device.name}</div>
                          <div className="text-xs text-purple-300">{device.room}</div>
                        </div>
                      </button>
                    ))}
                  </div>
                </div>

                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20 lg:col-span-2">
                  <div className="flex items-center gap-2 mb-4">
                    <Icon name="Newspaper" className="w-6 h-6 text-purple-400" />
                    <h2 className="text-lg font-semibold">NotÃ­cias Locais</h2>
                  </div>
                  <div className="space-y-3">
                    {news.slice(0, 3).map(item => (
                      <div key={item.id} className="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all cursor-pointer">
                        <h3 className="font-semibold mb-1 text-sm">{item.title}</h3>
                        <div className="flex items-center gap-3 text-xs text-purple-300">
                          <span>{item.source}</span>
                          {item.time && (
                            <>
                              <span>â€¢</span>
                              <span>{item.time}</span>
                            </>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20">
                  <div className="flex items-center gap-2 mb-4">
                    <Icon name="Calendar" className="w-6 h-6 text-purple-400" />
                    <h2 className="text-lg font-semibold">Agenda</h2>
                  </div>
                  <div className="space-y-3">
                    {agenda.map(item => (
                      <div key={item.id} className="bg-white/5 rounded-xl p-3">
                        <div className="flex items-center gap-3">
                          <div className="bg-purple-600 rounded-lg px-3 py-2 text-sm font-bold">
                            {item.time}
                          </div>
                          <div className="flex-1">
                            <div className="font-semibold text-sm">{item.event}</div>
                            <div className="text-xs text-purple-300">{item.date}</div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20 lg:col-span-3">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-2">
                      <Icon name="CheckSquare" className="w-6 h-6 text-purple-400" />
                      <h2 className="text-lg font-semibold">Tarefas da Casa</h2>
                    </div>
                    <button
                      onClick={() => setShowAddTask(true)}
                      className="bg-purple-600 hover:bg-purple-700 p-2 rounded-lg transition-all active:scale-95"
                    >
                      <Icon name="Plus" className="w-5 h-5" />
                    </button>
                  </div>
                  
                  {showAddTask && (
                    <div className="mb-4 flex gap-2">
                      <input
                        type="text"
                        value={newTaskText}
                        onChange={(e) => setNewTaskText(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && addTask()}
                        placeholder="Nova tarefa..."
                        className="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-purple-300 focus:outline-none focus:border-purple-400"
                        autoFocus
                      />
                      <button onClick={addTask} className="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">
                        Adicionar
                      </button>
                      <button onClick={() => setShowAddTask(false)} className="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg">
                        <Icon name="X" className="w-5 h-5" />
                      </button>
                    </div>
                  )}
                  
                  <div className="grid md:grid-cols-3 gap-3">
                    {tasks.map(task => (
                      <div
                        key={task.id}
                        onClick={() => toggleTask(task.id)}
                        className={`p-4 rounded-xl cursor-pointer transition-all ${
                          task.done 
                            ? 'bg-green-600/30 border border-green-400/50' 
                            : 'bg-white/5 border border-white/20 hover:bg-white/10'
                        }`}
                      >
                        <div className="flex items-center gap-3">
                          <div className={`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${
                            task.done ? 'bg-green-500 border-green-500' : 'border-white/40'
                          }`}>
                            {task.done && <span className="text-white text-xs">âœ“</span>}
                          </div>
                          <span className={`text-sm ${task.done ? 'line-through text-purple-300' : ''}`}>{task.text}</span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {showCommandModal && selectedDevice && (
                <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowCommandModal(false)}>
                  <div className="bg-gradient-to-br from-slate-800 to-purple-900 rounded-2xl p-6 max-w-md w-full border border-purple-400/30" onClick={e => e.stopPropagation()}>
                    <div className="flex items-center gap-3 mb-4">
                      <div className="bg-purple-600 p-3 rounded-xl">
                        {getDeviceIcon(selectedDevice.type)}
                      </div>
                      <div>
                        <h3 className="text-xl font-bold">{selectedDevice.name}</h3>
                        <p className="text-purple-300 text-sm">{selectedDevice.room}</p>
                      </div>
                    </div>
                    
                    <div className="bg-blue-600/20 border border-blue-400/30 rounded-xl p-4 mb-4">
                      <div className="flex items-center gap-2 mb-2">
                        <Icon name="Mic" className="w-5 h-5 text-blue-400" />
                        <span className="font-semibold">Comando de Voz</span>
                      </div>
                      <p className="text-blue-100 text-sm font-mono">{selectedDevice.alexaCommand}</p>
                    </div>

                    <div className="bg-purple-600/20 border border-purple-400/30 rounded-xl p-4 mb-4">
                      <p className="text-sm text-purple-200">
                        ðŸ’¡ <strong>Dica:</strong> Use sua Alexa normalmente! Este dispositivo jÃ¡ estÃ¡ conectado via Tuya Smart.
                      </p>
                    </div>
                    
                    <button
                      onClick={() => setShowCommandModal(false)}
                      className="w-full bg-purple-600 hover:bg-purple-700 py-3 rounded-xl font-semibold transition-all"
                    >
                      Fechar
                    </button>
                  </div>
                </div>
              )}

              <footer className="mt-8 text-center text-purple-300 text-xs">
                <p>Central de AutomaÃ§Ã£o Residencial â€¢ Integrado com Alexa via Tuya Smart</p>
              </footer>
            </div>
          );
        }

        ReactDOM.render(<HomeAutomationHub />, document.getElementById('root'));
    </script>
</body>
</html>