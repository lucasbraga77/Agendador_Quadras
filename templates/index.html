<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendador de Quadras</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <h1>‚ö° Agendador de Quadras</h1>
    
    <!-- SELETOR DE MODO -->
    <div class="modo-selector">
        <button class="modo-btn active" data-modo="reserva" onclick="selectModo('reserva')">
            <span class="emoji">‚ö°</span>
            <span class="titulo">Reservar Agora</span>
            <span class="desc">Tenta agendar imediatamente</span>
        </button>
        <button class="modo-btn" data-modo="agendado" onclick="selectModo('agendado')">
            <span class="emoji">‚è∞</span>
            <span class="titulo">Agendar √†s 14h</span>
            <span class="desc">Execu√ß√£o programada</span>
        </button>
    </div>

    <!-- FORMUL√ÅRIO -->
    <div class="form-section">
        <div class="input-group">
            <input id="user" type="text" placeholder="Usu√°rio" required>
        </div>
        
        <div class="input-group">
            <input id="senha" type="password" placeholder="Senha" required>
        </div>

        <div class="input-group" id="data-container" style="display: none;">
            <input id="data" type="date" placeholder="Data">
            <small>Deixe em branco para amanh√£</small>
        </div>
    </div>

    <!-- QUADRAS -->
    <div class="section">
        <h3>üéæ Quadras</h3>
        <div id="quadras" class="checkbox-grid">
            <label class="checkbox-label">
                <input type="checkbox" value="PADEL-1">
                <span>PADEL-1</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="PADEL-2">
                <span>PADEL-2</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="PADEL-3">
                <span>PADEL-3</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="PADEL-4">
                <span>PADEL-4</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="PADEL-5">
                <span>PADEL-5</span>
            </label>
        </div>
    </div>

    <!-- HOR√ÅRIOS -->
    <div class="section">
        <h3>üïê Hor√°rios</h3>
        <div id="horarios" class="checkbox-grid horarios-grid">
            <label class="checkbox-label">
                <input type="checkbox" value="09:30">
                <span>09:30</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="10:45">
                <span>10:45</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="12:00">
                <span>12:00</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="13:15">
                <span>13:15</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="14:30">
                <span>14:30</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="15:45">
                <span>15:45</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="17:00">
                <span>17:00</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="18:15">
                <span>18:15</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="19:30">
                <span>19:30</span>
            </label>
            <label class="checkbox-label">
                <input type="checkbox" value="20:45">
                <span>20:45</span>
            </label>
        </div>
    </div>

    <!-- BOT√ïES -->
    <div class="actions">
        <button class="btn-primary" onclick="start()">
            <span id="btn-text">‚ñ∂ Iniciar</span>
        </button>
        <button class="btn-cancel" onclick="cancel()">
            ‚èπ Cancelar
        </button>
    </div>

    <!-- LOG -->
    <div class="log-section">
        <h3>üìã Log de Execu√ß√£o</h3>
        <pre id="log"></pre>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <small>Developed by Lucas Braga | Vers√£o Web 2.0</small>
    </div>
</div>

<script>
let modoAtual = 'reserva';

function selectModo(modo) {
    modoAtual = modo;
    
    // Atualiza bot√µes
    document.querySelectorAll('.modo-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-modo="${modo}"]`).classList.add('active');
    
    // Mostra/esconde campo de data
    const dataContainer = document.getElementById('data-container');
    const btnText = document.getElementById('btn-text');
    
    if (modo === 'reserva') {
        dataContainer.style.display = 'block';
        btnText.textContent = '‚ö° Reservar Agora';
    } else {
        dataContainer.style.display = 'none';
        btnText.textContent = '‚è∞ Agendar √†s 14h';
    }
}

function getChecked(name) {
    return Array.from(document.querySelectorAll(`#${name} input:checked`))
        .map(e => e.value);
}

function start() {
    const quadras = getChecked("quadras");
    const horarios = getChecked("horarios");
    
    if (!user.value || !senha.value) {
        alert("Preencha usu√°rio e senha!");
        return;
    }
    
    if (quadras.length === 0 || horarios.length === 0) {
        alert("Selecione ao menos uma quadra e um hor√°rio!");
        return;
    }
    
    const payload = {
        user: user.value,
        senha: senha.value,
        quadras: quadras,
        horarios: horarios,
        modo: modoAtual
    };
    
    // Adiciona data se n√£o for modo agendado
    if (modoAtual !== 'agendado' && data.value) {
        payload.data = data.value;
    }
    
    fetch("/start", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(data => {
        if (data.status === "erro") {
            alert(data.msg);
        }
    });
}

function cancel() {
    fetch("/cancel", {method: "POST"});
}

// Atualiza logs a cada segundo
setInterval(() => {
    fetch("/logs")
        .then(r => r.json())
        .then(data => {
            const logEl = document.getElementById('log');
            logEl.textContent = data.join("\n");
            logEl.scrollTop = logEl.scrollHeight;
        });
}, 1000);

// Define data de amanh√£ como padr√£o
const amanha = new Date();
amanha.setDate(amanha.getDate() + 1);
document.getElementById('data').value = amanha.toISOString().split('T')[0];
</script>
</body>
</html>